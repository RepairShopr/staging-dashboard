<p id="notice"><%= notice %></p>


<div class="row">
  <% @servers.each do |server| %>
      <div class="col-sm-4 col-xs-6" style="padding-bottom: 20px;">
        <div class="bs-component dashboard-card">
          <div class="card">
            <h3 class="card-info card-header"></h3>
            <h3 class="card-header"><%= server.name %></h3>
            <div class="card-block">
              <h5 class="card-title">Branch: <%= server.deploys.last.try(:git_branch) || "master" %></h5>
              <h6 class="card-subtitle text-muted"><%= server.dynamic_status %></h6>
            </div>
            <img style="height: 200px; width: 100%; display: block; vertical-align: top;" src="<%= server.thumbnail_image || image_path("sample-thumbnail.png", skip_pipeline: true) %>" alt="Card image">
            <div class="card-block">
              <p class="card-text alert-warning">
                <% if server.reserved_until.present? && server.reserved_until > Time.now-6.hours %>
                    Until: <%= l server.reserved_until, format: :short%><br>
                    <%= server.reserved_for %>
                <% end %>
              </p>
              <p class="card-text" title="<%= server.deploys.last.try(:git_commit_message) %>"><%= server.deploys.last.try(:git_commit_message).to_s.truncate(80) %></p>
              <a href="https://<%= server.server_url %>" class="card-link">Server link</a>
              <%= link_to "Reserve", "#", class: "card-link bhvCardReserve bhvCardReserve-#{server.id}", data: {server: server.id}  %>
              <div class="bhvHideReserveForm-<%= server.id %>" style="display: none;">
                <%= form_with(model: server, local: true) do |form| %>

                    <div class="field">
                      <%= form.label "Reserved for (Reason)" %>
                      <%= form.text_field :reserved_for %>
                    </div>

                    <div class="field">
                      <%= form.label :reserve_time %>

                      <%= form.select(:reserved_until) do %>
                          <% [['1 Hr', 1], ['2 Hrs', 2], ['8 Hrs', 8], ['1 Day', 24], ['2 Days', 48], ['7 Days', 168]].each do |c| -%>
                              <%= content_tag(:option, c.first, value: c.last) %>
                          <% end %>
                      <% end %>
                    </div>


                    <div class="actions">
                      <%= form.submit %>
                    </div>
                <% end %>

              </div>
            </div>
            <div class="card-footer text-muted text-xs-center">
              <%= time_ago_in_words(server.deploys.last.try(:created_at) || server.updated_at) %> Ago
            </div>
          </div>
        </div>
      </div>
  <% end %>
</div>

<script>
  $( document ).ready(function() {
    console.log( "ready!" );
    $( ".bhvCardReserve" ).click(function(e) {
      e.preventDefault()
      console.log( "Handler for .click() called.",e.currentTarget.dataset.server );
      $(".bhvHideReserveForm-"+e.currentTarget.dataset.server).show()
    });
  });
</script>

<br>

<%= link_to 'New Server', new_server_path %>


<hr> example stuff from bootstrap down here - delete below when happy with how this page looks!


<div class="bs-docs-section">




  <div class="row">
    <div class="col-lg-12">
      <h2>Cards</h2>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-4">
      <div class="bs-component">
        <div class="card card-inverse card-primary text-xs-center">
          <div class="card-block">
            <blockquote class="card-blockquote">
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer posuere erat a ante.</p>
              <footer>Someone famous in <cite title="Source Title">Source Title</cite></footer>
            </blockquote>
          </div>
        </div>
        <div class="card card-inverse card-success text-xs-center">
          <div class="card-block">
            <blockquote class="card-blockquote">
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer posuere erat a ante.</p>
              <footer>Someone famous in <cite title="Source Title">Source Title</cite></footer>
            </blockquote>
          </div>
        </div>
        <div class="card card-inverse card-info text-xs-center">
          <div class="card-block">
            <blockquote class="card-blockquote">
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer posuere erat a ante.</p>
              <footer>Someone famous in <cite title="Source Title">Source Title</cite></footer>
            </blockquote>
          </div>
        </div>
        <div class="card card-inverse card-warning text-xs-center">
          <div class="card-block">
            <blockquote class="card-blockquote">
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer posuere erat a ante.</p>
              <footer>Someone famous in <cite title="Source Title">Source Title</cite></footer>
            </blockquote>
          </div>
        </div>
        <div class="card card-inverse card-danger text-xs-center">
          <div class="card-block">
            <blockquote class="card-blockquote">
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer posuere erat a ante.</p>
              <footer>Someone famous in <cite title="Source Title">Source Title</cite></footer>
            </blockquote>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="bs-component">
        <div class="card card-outline-primary text-xs-center">
          <div class="card-block">
            <blockquote class="card-blockquote">
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer posuere erat a ante.</p>
              <footer>Someone famous in <cite title="Source Title">Source Title</cite></footer>
            </blockquote>
          </div>
        </div>
        <div class="card card-outline-success text-xs-center">
          <div class="card-block">
            <blockquote class="card-blockquote">
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer posuere erat a ante.</p>
              <footer>Someone famous in <cite title="Source Title">Source Title</cite></footer>
            </blockquote>
          </div>
        </div>
        <div class="card card-outline-info text-xs-center">
          <div class="card-block">
            <blockquote class="card-blockquote">
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer posuere erat a ante.</p>
              <footer>Someone famous in <cite title="Source Title">Source Title</cite></footer>
            </blockquote>
          </div>
        </div>
        <div class="card card-outline-warning text-xs-center">
          <div class="card-block">
            <blockquote class="card-blockquote">
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer posuere erat a ante.</p>
              <footer>Someone famous in <cite title="Source Title">Source Title</cite></footer>
            </blockquote>
          </div>
        </div>
        <div class="card card-outline-danger text-xs-center">
          <div class="card-block">
            <blockquote class="card-blockquote">
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer posuere erat a ante.</p>
              <footer>Someone famous in <cite title="Source Title">Source Title</cite></footer>
            </blockquote>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-4">
      <div class="bs-component">
        <div class="card">
          <h3 class="card-header">Card header</h3>
          <div class="card-block">
            <h5 class="card-title">Special title treatment</h5>
            <h6 class="card-subtitle text-muted">Support card subtitle</h6>
          </div>
          <img style="height: 200px; width: 100%; display: block;" src="data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%22318%22%20height%3D%22180%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20318%20180%22%20preserveAspectRatio%3D%22none%22%3E%3Cdefs%3E%3Cstyle%20type%3D%22text%2Fcss%22%3E%23holder_158bd1d28ef%20text%20%7B%20fill%3Argba(255%2C255%2C255%2C.75)%3Bfont-weight%3Anormal%3Bfont-family%3AHelvetica%2C%20monospace%3Bfont-size%3A16pt%20%7D%20%3C%2Fstyle%3E%3C%2Fdefs%3E%3Cg%20id%3D%22holder_158bd1d28ef%22%3E%3Crect%20width%3D%22318%22%20height%3D%22180%22%20fill%3D%22%23777%22%3E%3C%2Frect%3E%3Cg%3E%3Ctext%20x%3D%22129.359375%22%20y%3D%2297.35%22%3EImage%3C%2Ftext%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E" alt="Card image">
          <div class="card-block">
            <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
            <a href="#" class="card-link">Card link</a>
            <a href="#" class="card-link">Another link</a>
          </div>
          <div class="card-footer text-muted text-xs-center">
            2 days ago
          </div>
        </div>
      </div>
    </div>
  </div>

</div>